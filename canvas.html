<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
			var draw = {
				isDrawing: false,
				surface: null,

				setup: function(){
					var myCanvas = document.getElementById('myCanvas')
					myCanvas.width = window.innerWidth;
					myCanvas.height = window.innerHeight;
					this.surface = myCanvas.getContext('2d');
					this.surface.lineWidth = 5;
					this.surface.strokeStyle = '#0000ff';
				},
				
				beginDraw: function(x, y){
					this.surface.beginPath();
					this.surface.moveTo(x, y);

					this.isDrawing = true;
				},

				draw: function(x, y){
					this.surface.lineTo(x, y);
					this.surface.stroke();
				},

				endDraw: function(){
					this.isDrawing = false;
				}
			};

			var socketIo = {
				socket: null,

				setup: function(){
					this.socket = io.connect('http://localhost:8080');

					this.socket.on('initDraw', function(data){
						draw.beginDraw(data.x, data.y);
					});

					this.socket.on('draw', function(data){
						draw.draw(data.x, data.y);
					});

					this.socket.on('endDraw', function(data){
						draw.endDraw();
					});
				},

				EmitInitLine: function(x, y){
					this.socket.emit('initDraw', {x: x, y: y});
				},

				EmitLine: function(x, y){
					this.socket.emit('draw', {x: x, y: y});
				},

				EmitEndLine: function(){
					this.socket.emit('endDraw');
				}
			};

			$(function () {
				draw.setup();
				socketIo.setup();

				$('#myCanvas').mousedown(function(data){
					draw.beginDraw(data.offsetX, data.offsetY);
					socketIo.EmitInitLine();
				});

				$('#myCanvas').mousemove(function(data){
					if(draw.isDrawing === true){
						draw.draw(data.offsetX, data.offsetY);
						socketIo.EmitLine(data.offsetX, data.offsetY);
					}
				});

				$('#myCanvas').mouseup(function(data){
					draw.endDraw();
					socketIo.EmitEndLine();
				});

				
			});
		</script>
	</head>

	<body>
		<canvas id="myCanvas"></canvas>
	</body>
</html>